---
layout: post
title: MySQL优化数据表
description: "MySQL数据表优化方法，MySQL如何优化数据表，MySQL怎么优化数据表，如何对MySQL进行数据表优化，MySQL优化数据表方式"
modified: 2016-10-13
tags: [mysql]
categories: [intro]
---
##选择优化的数据类型

###更小的通常更好

一般情况下，应尽量使用可以正确存储数据的最小数据类型。更小的数据类型通常更快，因为他们占用更少的磁盘、内存和CPU缓存，并处理时需要的CPU周期也更少。

但要确保没有低估需要存储的值的范围，因为当schema中数据量增大后，再对数据类型范围进行更改会非常耗时。

###简单就好

简单数据类型的操作通常需要更少的CPU周期。例如，应使用MySQL内建类型而不是字符串来存储日期和时间；应使用整型存储IP地址。

###尽量避免NULL

通常情况下最好指定列为NOT NULL，除非真的需要存储NULL值。因为当列中存在NULL的话，会使索引、索引统计和值比较变得更复杂。同时，可为NULL的列会使用更多的存储空间，当值为NULL的列被索引时，每个索引记录需要一个额外字节，甚至再MyISAM中将会导致固定大小的索引变为可变大小的索引。

通常在建立索引的时候，应该避免可为NULL的列。但在后期调优的过程中，将NULL的列改为NOT NULL所带来的性能提升比较小，因此在此阶段没有必要首先将所有schema中所有的NULL列转换过来，除非确定这是问题所在。

<!-- more -->

###针对具体数据类型

1、为整型类型指定宽度，例如INT(11)，只是用来在一些界面工具上显示字符的个数，对于存储与计算来说，INT(1)和INT(20)是一样的。此外，把整型类型作为选择标识符是最好的选择。

2、浮点和DECIMAL类型都可以指定精度，对于DECIMAL，指定小数点前后最大位数会影响列的空间消耗。而且当制定精度后，MySQL会瞧瞧选择不同的数据类型，或在存储是对值进行取舍。因此建议至指定数据类型，不指定精度。

3、当数据量大时，建议使用BIGINT代替DECIMAL。（在存储时乘以倍数化为整数，而后在处理时除以倍数以获取精确值。）

4、VARCHAR类型用于储存可变长字符串，比定长类型更节省空间。由于行时变长的，在UPDATE时可能使行变得比原来更长，这就会导致需要做额外工作。因此varchar的使用环境为：字符串列的最大长度比平均长度大很多；列的更新很少；使用了向UTF-8这样复杂的字符集。

CHAR类型是定长的，因此是和存储很短的字符串，或所有值都接近同一个长度。

5、ENUM类型在存储时会非常紧凑，尽量使用ENUM类型代替字符串；而且把列转换成ENUM后，关联会加快。但该类型字符串列表是固定的，添加或删除字符串必须使用ALTER TABLE，不要储存容易变动的字符串；同时储存和排序数据实际是化为整数操作，而不是字符串，当使用数字作为ENUM枚举常量时，容易导致混乱。

6、建议使用TIMESTAMP，因为它比DATETIME空间效率更高，用整型类型存储时间戳不会带来任何收益，而且处理时间格式时间不方便。需要注意，TIMEStAMP显示的值以来时区，而DATETIME则不会。

7、应谨避免使用BIT类型，可用CHAR代替存储true/false值。SET类型较方便查询，因为MySQL列入FIND_INSET()和FIELD()函数，但改变列的定义代价很高。

###MySQL schema设计中的陷阱

1、太多的列

2、太多的关联

3、太过依赖枚举

4、尽量避免使用NULL并不代表不能使用NULL，有时使用NULL会比-1的效率更高。

###范式和反范式

1、范式的优点和缺点

优点：

-范式化的更新操作通常比反范式化要快。

-几乎不存在重复数据，因此便于修改数据。

-范式化的表通常很小，可更好的放在内存里，因此执行操作会更快。

-更少的使用DISTINCT或GROUP BY。

缺点：-通常一次或多次需要关联，不但代价昂贵，还可能使索引策略无效。

2、反范式的优点和缺点

优点：-可很好的避免关联，当数据比内存大时，避免了随机I/O,会比关联快得多。

缺点：-参考范式的优点。

3、通常情况下，采用范式化和反范式化混合使用的方式建立高效schema。

###缓存表和汇总表

在忽略复杂、实时更新的情况下，提升性能的最好方法是在同一张表中保存衍生的冗余数据。将较简单的从schema获取的数据存储在“缓存表”，将需使用GROUP BY语句聚合查询的数据存在“汇总表”。

如果需要在表中保存计数器，可单独创建一张“计数器表”。

###加快ALTER TABLE操作的速度

某些操作不需要重建表：

-移除（不是增加）一个列的AUTO_INCREMENT属性

-增加、移除，或更改ENUM和SET常量。

1、修改.frm文件

-创建一张相同结构的空表(like)，并进行修改。

-执行FLUSH TABLES WITH READ LOCK。

-交换.frm文件。

-执行UNLOCK TABLES。

2、快速创建MyISAM索引
先禁用索引(必须为非唯一索引)，载入数据，然后重启索引。


