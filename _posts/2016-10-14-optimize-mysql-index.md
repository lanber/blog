---
layout: post
title: MySQL优化索引
description: "MySQL索引优化方法，MySQL如何优化索引，MySQL怎么优化索引，如何对MySQL进行索引优化，MySQL优化索引方式"
modified: 2016-10-14
tags: [mysql]
categories: [intro]
---
##一、索引的类型

###B-Tree索引

####优点：

-顺序存储，且每一个叶子页到跟的距离相同。

-不在需要全表扫描，取而代之的是从索引的根节点开始进行搜索，加快了访问数据的速度。

<!-- more -->

###缺点:

-如果不是按照索引的最左列开始查找，则无法使用索引。

-无法查找同时满足条件的多列。

-如果查询中存在某列的范围查询(例如like)，则其右边所有列均无法使用索引优化查找。

###哈希索引

####优点:

-基于哈希表实现，只有精确匹配索引所有列的查询才有效。

-因只需存储对应的哈希值，因此索引结构非常紧凑，从而加快搜索速度。

####缺点：

-哈希索引只包含哈希值喝行指针，而不存储字段值，但访问内容中的行的速度很快，所以影响不大。

-哈希索引不是按照索引值的顺序存储的，因此无法用于排序。

-因哈希索引需使用列中全部内容来计算哈希值，哈希索引不支持部分索引匹配查找。若在数据列(A,B)上建立哈希索引，若只查询数据列A则无法使用索引。

-哈希索引也不支持范围查询，只支持等值比较。

-当出现冲突时，存储引擎不许遍历链表中所有行指针，如果出现大量冲突，则会影响查询速度，同时维护代价也会加大。

###空间数据索引（R-Tree）

####优点：

-可用作地理数据存储。

-与B-Tree不同，此类索引无需前缀查询。

####缺点：

-必须使用GIS相关函数进行维护，相较于PostgreSQL而言，MySQL的GIS支持不完善。

###全文索引

-全文索引是一种特殊类型的索引，她查找的是文本中的关键词，而不是直接比较索引中的值。

-需注意停用词、词干和负数、布尔搜索等。

##二、索引的优点

-索引大大减少了服务器需要扫描的数据量。

-索引可以帮助服务器避免排序和临时表。

-索引可以将随机I/O变为顺序I/O。

（索引在中到大型表中很有效。对于非常小的表，通常扫描全表效率更高；而对于特大型表，使用分区技术更加高效。）

##三、高性能索引策略

-独立的列。索引列不能使表达式的一部分，也不能是函数的参数。

-前缀索引和索引选择性。可以索引开始部分的字符，提高索引效率，但也会降低索引的选择性。索引选择性指的是不重复记录（技术）与数据表记录总数的比值，1为最好,sql语句表示为

{% highlight ruby %}

SELECT COUNT(DISTINCT LEFT(columnname,前缀数字符数))/COUNT(*) FROM tablename;

{% endhighlight %}

建立索引的语句为

{% highlight ruby %}

ALTER TABLE tablename ADD KEY(columnname(前缀字符数));

{% endhighlight %}

-使用多列索引。一个常见的错误就是，为每个列创建独立的索引，从而触发MySQL的索引合并策略。但索引合并策略在某些时候会很糟糕：

1、当出现服务器对多个索引做AND操作时，意味着需要包含所有AND条件的多列索引，而不是多个单列索引。

2、当出现服务器对多个索引做OR操作时，通常需要消耗大量CPU和黑村资源在算法的缓存、排序和合并操作上。有时实在索引选择性不高的情况下，须合并大量数据。

3、优化器不会把这些计算在查询成本(cost)中，会导致查询成本被低估。

-选择合适的索引列顺序
